# Schema Configuration for Test Recommendation System
# This file defines how CSV data is mapped to the system's internal model
#
# IMPORTANT: This is the SINGLE SOURCE OF TRUTH for CSV column mappings.
# To use a new CSV file with different column names, update the column_mappings
# section below - no Python code changes required.

# =============================================================================
# FIELD PROCESSING CONFIGURATION
# Defines how special fields are derived/processed
# =============================================================================

field_processing:
  # How to extract domain from tickets
  # Options: 'from_column' | 'from_ticket_key'
  domain_extraction_mode: from_column

  # If domain_extraction_mode is 'from_ticket_key', define the key pattern
  # The system will extract the domain code from ticket_id using this regex
  # Example: JIRA-MM-001 -> extracts 'MM' using group 1
  ticket_key_domain_pattern: "^[A-Z]+-([A-Z]+)-\\d+"
  ticket_key_domain_map:
    MM: MM
    CI: CIW
    SP: Specialty

  # Date format for parsing created_date and closed_date columns
  # Uses Python strptime format codes
  date_format: "%Y-%m-%d %H:%M:%S"

  # How to split resolution steps (regex pattern)
  # Default splits by numbered steps "1. " or newlines
  resolution_split_pattern: "\\d+\\.\\s*|\\n"

  # How to split labels (simple delimiter)
  labels_delimiter: ","

# =============================================================================
# VECTORIZATION CONFIGURATION
# Define which columns should be used to generate embeddings
# Only these columns will be concatenated and sent to the embedding model
# =============================================================================

vectorization:
  # Columns to include in the embedding text (in order of concatenation)
  # Use INTERNAL field names (from column_mappings keys), not CSV column names
  columns:
    - description        # Core content - always include
    - test_steps         # Test step details
    - expected_result    # Expected outcomes
    - precondition       # Setup requirements
    - category_labellings    # Category labels for context

  # Separator between column values when concatenating
  separator: ". "

  # Whether to clean/normalize text before embedding
  clean_text: true

  # Maximum tokens per embedding (text-embedding-3-large supports 8191)
  max_tokens: 8000

# =============================================================================
# COLUMN MAPPINGS
# Map your CSV columns to the system's expected fields
# =============================================================================

column_mappings:
  # ==========================================================================
  # CORE FIELDS (Required - must exist in your CSV)
  # ==========================================================================
  ticket_id: Issue_Key          # Unique identifier for each record
  title: Summary                # Short title/summary
  description: Description      # Detailed description

  # ==========================================================================
  # METADATA FIELDS (Optional - set to null if not in your CSV)
  # ==========================================================================
  priority: null                # Priority level (derived from story_points if null)
  resolution_steps: Expected_Result  # Resolution steps (can be null)
  created_date: null            # Created date column (can be null)
  closed_date: null             # Closed date column (can be null)
  issue_type: Type              # Type of issue (can be null)
  assignee: Labels6             # Person assigned (can be null)
  label: Category_Labellings                 # Team name (can be null)
  reporter: null                # Reporter email (can be null)

  # ==========================================================================
  # TEST PLAN SPECIFIC FIELDS (Optional)
  # ==========================================================================
  precondition: Precondition
  test_steps: Test_Step_Description
  expected_result: Expected_Result
  story_points: Story_Points
  status: Status

  # ==========================================================================
  # LABEL FIELDS (for categorization)
  # These columns contain labels/tags for the ticket
  # ==========================================================================
  category_labels: category_labels  # Main category labels column

# =============================================================================
# LABEL CONFIGURATION
# Define which columns contain labels and how to process them
# =============================================================================

labels:
  # Columns that contain label values (will be combined into a single list)
  columns:
    - category_labels   # Refinement status

  # Columns to EXCLUDE from labels (even if they start with "Label")
  exclude_columns:
   # - Labels #    # This contains story IDs, not labels

# =============================================================================
# DOMAIN CONFIGURATION
# Define the domains used for classification
# =============================================================================

domains:
  # Domain extraction: which column determines the domain?
  #extraction_column: Labels2

  # Mapping from column values to domain names
  # Format: csv_value: domain_name
  domain_map:
    BL-CORE: Billing
    EN-ENROLL: Enrollment
    CL-CLAIMS: Claims
    PR-PREMIUM: Premium
    RN-RENEWAL: Renewal
    IN-INTEGRATION: Integration
    RP-REPORTING: Reporting
    CS-CUSTSERV: CustomerService
    SEC-SECURITY: Security
    PF-PERFORMANCE: Performance

  # Domain definitions with display info and classification prompts
  definitions:
    Billing:
      full_name: "Core Billing Services"
      description: "Billing operations, invoicing, payment processing, AWD setup"
      color_scheme: blue
      classification_prompt: |
        You are an AI classifier for Billing domain test cases in a healthcare system.

        This domain covers:
        - Invoice generation and billing cycles
        - Payment processing (AWD - Auto Withdrawal Debit)
        - Premium calculations and rate changes
        - NSF (Non-Sufficient Funds) handling
        - Refund processing
        - Multi-contract billing consolidation

        Classify as Billing if the test case involves billing operations,
        payment methods, or financial transactions.

    Enrollment:
      full_name: "Member Enrollment Services"
      description: "Member enrollment, family plans, COBRA, SEP, dependent management"
      color_scheme: green
      classification_prompt: |
        You are an AI classifier for Enrollment domain test cases in a healthcare system.

        This domain covers:
        - New member enrollment
        - Family plan setup
        - Dependent additions (newborn, spouse)
        - COBRA continuation
        - Special Enrollment Period (SEP) due to QLE
        - Retroactive enrollment
        - Plan changes and migrations

        Classify as Enrollment if the test case involves member enrollment,
        plan selection, or coverage management.

    Claims:
      full_name: "Claims Processing"
      description: "Claims submission, adjudication, COB, denials, EOB generation"
      color_scheme: purple
      classification_prompt: |
        You are an AI classifier for Claims domain test cases in a healthcare system.

        This domain covers:
        - Claims submission and validation
        - Claims adjudication
        - Coordination of Benefits (COB)
        - Claims denial handling
        - EOB (Explanation of Benefits) generation
        - Grace period claim processing
        - Preventive care coverage validation

        Classify as Claims if the test case involves claims processing,
        payment to providers, or benefit determination.

    Premium:
      full_name: "Premium Calculation"
      description: "Premium rates, subsidies, rate changes, APTC calculations"
      color_scheme: amber
      classification_prompt: |
        You are an AI classifier for Premium domain test cases in a healthcare system.

        This domain covers:
        - Premium rate calculations
        - Rate change processing
        - APTC (Advanced Premium Tax Credit) subsidies
        - Premium breakdown and allocation
        - 1095-A form data accuracy

        Classify as Premium if the test case involves premium calculations,
        subsidies, or rate management.

    Renewal:
      full_name: "Renewal Processing"
      description: "Annual renewals, plan migrations, AWD continuation"
      color_scheme: orange
      classification_prompt: |
        You are an AI classifier for Renewal domain test cases in a healthcare system.

        This domain covers:
        - Annual renewal processing
        - Plan change at renewal
        - AWD continuation through renewal
        - Coverage gap prevention
        - Year-over-year transitions

        Classify as Renewal if the test case involves annual renewals
        or year-end/year-start transitions.

    Integration:
      full_name: "System Integration"
      description: "EDI transactions, payment gateway, external system interfaces"
      color_scheme: cyan
      classification_prompt: |
        You are an AI classifier for Integration domain test cases in a healthcare system.

        This domain covers:
        - EDI 834 enrollment transactions
        - Payment gateway integration
        - ACH file generation and processing
        - Trading partner communication
        - External system interfaces

        Classify as Integration if the test case involves system integration,
        data exchange, or external interfaces.

    Reporting:
      full_name: "Analytics & Reporting"
      description: "Dashboards, reconciliation reports, data analytics"
      color_scheme: indigo
      classification_prompt: |
        You are an AI classifier for Reporting domain test cases in a healthcare system.

        This domain covers:
        - Dashboard accuracy
        - Reconciliation reports
        - Data export and analytics
        - Report scheduling and distribution
        - Metric calculations

        Classify as Reporting if the test case involves reports,
        dashboards, or data analytics.

    CustomerService:
      full_name: "Customer Service"
      description: "CSR portal, member support, account updates"
      color_scheme: pink
      classification_prompt: |
        You are an AI classifier for CustomerService domain test cases in a healthcare system.

        This domain covers:
        - Customer service portal functionality
        - Member account updates via CSR
        - AWD banking detail changes
        - Cancellation request processing
        - Member support workflows

        Classify as CustomerService if the test case involves CSR operations
        or member support processes.

    Security:
      full_name: "Security & Compliance"
      description: "Data encryption, RBAC, PCI-DSS compliance, audit trails"
      color_scheme: red
      classification_prompt: |
        You are an AI classifier for Security domain test cases in a healthcare system.

        This domain covers:
        - Data encryption (at rest and in transit)
        - Role-based access control (RBAC)
        - PCI-DSS compliance
        - Audit logging
        - Key rotation
        - Authorization testing

        Classify as Security if the test case involves security controls,
        compliance, or access management.

    Performance:
      full_name: "Performance Testing"
      description: "Load testing, batch processing SLAs, throughput benchmarks"
      color_scheme: slate
      classification_prompt: |
        You are an AI classifier for Performance domain test cases in a healthcare system.

        This domain covers:
        - Batch processing performance
        - Load testing and throughput
        - SLA compliance
        - Processing time benchmarks
        - Error rate monitoring under load

        Classify as Performance if the test case involves performance testing,
        load testing, or SLA validation.

# =============================================================================
# PRIORITY CONFIGURATION
# Define how priority is determined
# =============================================================================

priority:
  # If a priority column doesn't exist, derive from story_points
  derive_from: story_points

  # Story points to priority mapping
  story_points_map:
    low_max: 8        # <= 8 points = Low
    medium_max: 21    # <= 21 points = Medium
    high_max: 34      # <= 34 points = High
    # > 34 points = Critical

  # Valid priority values
  valid_values:
    - Low
    - Medium
    - High
    - Critical

# =============================================================================
# NOTE: UI CONFIGURATION HAS BEEN MOVED TO FRONTEND
# =============================================================================
# UI-related configuration (color schemes, sample placeholders) is now in:
# test-recom-frontend/config/schema-config.ts
#
# This follows the separation of concerns principle:
# - Backend: Data processing, business logic, domain classification prompts
# - Frontend: UI styling, colors, display configuration
